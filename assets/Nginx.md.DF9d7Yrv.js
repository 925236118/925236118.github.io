import{_ as s,c as a,o as n,a6 as i}from"./chunks/framework.3YdPo1hh.js";const u=JSON.parse('{"title":"","description":"","frontmatter":{},"headers":[],"relativePath":"Nginx.md","filePath":"Nginx.md","lastUpdated":1742542299000}'),l={name:"Nginx.md"},e=i(`<h2 id="说明" tabindex="-1">说明 <a class="header-anchor" href="#说明" aria-label="Permalink to &quot;说明&quot;">​</a></h2><ul><li>一个网络服务器</li></ul><h2 id="ubuntu使用nginx" tabindex="-1">ubuntu使用nginx <a class="header-anchor" href="#ubuntu使用nginx" aria-label="Permalink to &quot;ubuntu使用nginx&quot;">​</a></h2><ul><li>安装</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx-core</span></span></code></pre></div><ul><li>检查是否安装成功</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><ul><li>安装路径</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">whereis</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span></code></pre></div><ul><li>安装后的常用目录 <ul><li><code>/usr/sbin/nginx</code>：主程序</li><li><code>/etc/nginx</code>：存放配置文件</li><li><code>/usr/share/nginx</code>：存放静态文件</li><li><code>/var/log/nginx</code>：存放日志</li></ul></li><li>启动服务</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> restart</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 重启</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">service</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 停止服务</span></span></code></pre></div><ul><li>修改配置文件</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> vim</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /etc/nginx/sites-available/default</span></span></code></pre></div><h2 id="windows使用nginx" tabindex="-1">windows使用nginx <a class="header-anchor" href="#windows使用nginx" aria-label="Permalink to &quot;windows使用nginx&quot;">​</a></h2><ul><li>安装 打开<a href="http://nginx.org/en/download.html" target="_blank" rel="noreferrer">下载地址</a>, 选择最新的稳定版本。下载后解压。</li><li>检查是否安装成功</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -v</span></span></code></pre></div><ul><li>安装后的常用目录（相对于解压目录） <ul><li><code>./</code>：主程序</li><li><code>./conf</code>：存放配置文件</li><li><code>./html</code>：存放网站站点文件</li><li><code>./logs</code>：存放日志</li></ul></li><li>启动服务</li></ul><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> nginx</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> reopen</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 重启</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> stop</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 停止服务</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -s</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> quit</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"> # 停止服务</span></span></code></pre></div><ul><li><p>修改配置文件 使用编辑器打开<code>./conf/nginx.conf</code></p></li><li><p>报错</p><ul><li>有时运行<code>nginx -s stop</code>或<code>nginx -s reopen</code>都会报错<code>[error] CreateFile() &quot;path/logs/nginx.pid&quot; fail</code>。 可以运行命令<code>nginx -c conf/nginx.conf</code></li></ul></li></ul><h2 id="配置项" tabindex="-1">配置项 <a class="header-anchor" href="#配置项" aria-label="Permalink to &quot;配置项&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>server {</span></span>
<span class="line"><span>		listen 80 default_server;</span></span>
<span class="line"><span>		listen [::]:80 default_server;</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		root /var/www/html;</span></span>
<span class="line"><span>		# Add index.php to the list if you are using PHP</span></span>
<span class="line"><span>		index index.html index.htm index.nginx-debian.html;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		server_name _;</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li><code>root</code>为站点的根目录</li><li><code>listen</code>为监听的端口</li><li><code>index</code>为index页面，可以自动识别</li><li><code>server_name</code>为服务器名称</li></ul><h2 id="通过域名前缀访问不同的端口的服务" tabindex="-1">通过域名前缀访问不同的端口的服务 <a class="header-anchor" href="#通过域名前缀访问不同的端口的服务" aria-label="Permalink to &quot;通过域名前缀访问不同的端口的服务&quot;">​</a></h2><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span># api.*   to   :3000</span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>		listen 80;</span></span>
<span class="line"><span>		server_name api.*;</span></span>
<span class="line"><span>		root /var/www/html/lenomand;</span></span>
<span class="line"><span>		location / {</span></span>
<span class="line"><span>				proxy_pass http://127.0.0.1:3000;      </span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="常见问题" tabindex="-1">常见问题 <a class="header-anchor" href="#常见问题" aria-label="Permalink to &quot;常见问题&quot;">​</a></h2><ul><li>静态服务器上传文件名中带有中文，导致请求失败 <ul><li>解决办法：将文件名转换成utf-8编码 <ul><li>sudo convmv -f gbk -t utf-8 -r --notest /var/www/public</li></ul></li></ul></li></ul><h2 id="使用ssl证书" tabindex="-1">使用SSL证书 <a class="header-anchor" href="#使用ssl证书" aria-label="Permalink to &quot;使用SSL证书&quot;">​</a></h2><ul><li>申请SSL证书</li><li>将SSL证书中的.crt文件和.key文件上传到服务器。</li><li>修改nginx配置</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>server {</span></span>
<span class="line"><span>        listen 80 default_server;</span></span>
<span class="line"><span>        root /var/www/html;</span></span>
<span class="line"><span>        index index.html;</span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>			# 重定向到https</span></span>
<span class="line"><span>			return 301 https://$host$request_uri;</span></span>
<span class="line"><span>#           try_files $uri $uri/ =404;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>server {</span></span>
<span class="line"><span>        listen 443 ssl;</span></span>
<span class="line"><span>		# 配置网站</span></span>
<span class="line"><span>        root /var/www/html;</span></span>
<span class="line"><span>        index index.html;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>        ssl_certificate path/to/file.crt;</span></span>
<span class="line"><span>        ssl_certificate_key path/to/file.key;</span></span>
<span class="line"><span>        ssl_session_timeout 5m;</span></span>
<span class="line"><span>        ssl_protocols TLSv1.2 TLSv1.3;</span></span>
<span class="line"><span>        ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:HIGH:!aNULL:!MD5:!RC4:!DHE;</span></span>
<span class="line"><span>        ssl_prefer_server_ciphers on;</span></span>
<span class="line"><span>        client_max_body_size 200M;</span></span>
<span class="line"><span>        location / {</span></span>
<span class="line"><span>        #       proxy_pass http://...;</span></span>
<span class="line"><span>        #       try_files $uri $uri/ =404;</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h2 id="使用免费ssl证书" tabindex="-1">使用免费SSL证书 <a class="header-anchor" href="#使用免费ssl证书" aria-label="Permalink to &quot;使用免费SSL证书&quot;">​</a></h2><h3 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h3><ul><li><a href="https://letsencrypt.org/zh-cn/" target="_blank" rel="noreferrer">Let&#39;s Encrypt 官网</a></li><li><a href="https://www.nginx-cn.net/company/blog/nginx/using-free-ssltls-certificates-from-lets-encrypt-with-nginx" target="_blank" rel="noreferrer">借助 NGINX 在 Let&#39;s Encrypt 中使用免费 SSL/TLS 证书</a></li></ul><h3 id="说明-1" tabindex="-1">说明 <a class="header-anchor" href="#说明-1" aria-label="Permalink to &quot;说明&quot;">​</a></h3><ul><li>安装certbot和python3-certbot-nginx</li><li>运行命令<div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> certbot</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --nginx</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> example.com</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -d</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> www.example.com</span></span></code></pre></div>有几个需要开通的域名就在后面接几个-d 域名</li><li>运行结束后，发现已经更新nginx的配置文件，自动添加了域名</li></ul><h3 id="自动更新证书" tabindex="-1">自动更新证书 <a class="header-anchor" href="#自动更新证书" aria-label="Permalink to &quot;自动更新证书&quot;">​</a></h3><ul><li>运行命令</li></ul><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">crontab</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -e</span></span></code></pre></div><ul><li>添加一行内容</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>0 12 * * * /usr/bin/certbot renew --quiet</span></span></code></pre></div><ul><li>以上命令表示每天中午运行该命令。该命令检查服务器上的证书是否会在未来 30 天内到期，如果是，则更新证书。--quiet 指令告知 certbot 不要生成输出。</li></ul>`,40),t=[e];function p(h,c,o,d,r,k){return n(),a("div",null,t)}const b=s(l,[["render",p]]);export{u as __pageData,b as default};
